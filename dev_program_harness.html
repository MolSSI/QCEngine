<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Adding a New Program Harness &mdash; QCEngine 0+untagged.1.g1a36ef7 documentation</title>
      <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />
      <link rel="stylesheet" href="_static/autodoc_pydantic.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="_static/jquery.js"></script>
        <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/sphinx_highlight.js"></script>
    <script src="_static/js/theme.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Changelog" href="changelog.html" />
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WJHQJQF');</script>
<!-- End Google Tag Manager -->
 

</head>

<body class="wy-body-for-nav">
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WJHQJQF"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->
 

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="index.html" class="icon icon-home">
            QCEngine
          </a>
              <div class="version">
                0+untagged.1.g1a36ef7
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Install QCEngine</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Interface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="single_compute.html">Single Compute</a></li>
<li class="toctree-l1"><a class="reference internal" href="environment.html">Environment Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="cli.html">Command Line Interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Programs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="program_overview.html">Program Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="programs_semiempirical.html">Semiempirical Quantum Mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="programs_molecular_mechanics.html">Molecular Mechanics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="api.html">QCEngine API</a></li>
<li class="toctree-l1"><a class="reference internal" href="changelog.html">Changelog</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Adding a New Program Harness</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">QCEngine</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">Adding a New Program Harness</li>
      <li class="wy-breadcrumbs-aside">
            <a href="_sources/dev_program_harness.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="adding-a-new-program-harness">
<h1>Adding a New Program Harness<a class="headerlink" href="#adding-a-new-program-harness" title="Permalink to this heading"></a></h1>
<p>Program harnesses are for community CMS codes that can independently
(or with a SCF bootstrap) compute single-point energies, derivatives,
or properties or components thereof (e.g., dispersion corrections).</p>
<p>A single CMS code generally has one program harness. However, if there
are drastically different ways of running a code (e.g., TeraChem text
input file and TeraChem PBS), separate harnesses may be created. Also,
if there are specialty capabilites not fitting into “single-point
energies …” (e.g., GAMESS makefp task), an additional <em>procedure</em>
harness may be created.</p>
<p>This guide is a coarse path through adding a new program harness.</p>
<ol class="arabic simple">
<li><p>Open up communication with the QCEngine maintainers. Post an issue
to GitHub and join the Slack channel (link off GH README) so you can
get advice.</p></li>
</ol>
<ol class="arabic simple">
<li><p>Copy a similar harness. Choose a program that your code behaves
roughly like (mostly consider parsed vs. API access) and copy that
harness, renaming it as your own and commenting out all but the
structure. Search for the (copied) harness name to register it.</p></li>
</ol>
<ol class="arabic simple">
<li><p>Fill in the <code class="docutils literal notranslate"><span class="pre">_defaults</span></code> section with program name and characteristics.</p></li>
</ol>
<ol class="arabic simple">
<li><p>Fill in the <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">found</span></code> function using <code class="docutils literal notranslate"><span class="pre">which</span></code> and
<code class="docutils literal notranslate"><span class="pre">which_import</span></code> from QCElemental. See NWChem and OpenMM for examples
of handling additional dependencies.</p></li>
</ol>
<ol class="arabic simple">
<li><p>If your code’s version can be extracted short of parsing an output
file, fill in <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">get_version</span></code> next. After this, <code class="docutils literal notranslate"><span class="pre">&gt;</span> <span class="pre">qcengine</span> <span class="pre">info</span></code>
should show your code (provided it’s in path).</p></li>
</ol>
<ol class="arabic simple">
<li><p>To get a string output of QCSchema Molecule in your code’s format,
you may need to add a <code class="docutils literal notranslate"><span class="pre">dtype</span></code> at <code class="docutils literal notranslate"><span class="pre">qcelemental/molparse/to_string.py</span></code>.</p></li>
</ol>
<ol class="arabic simple">
<li><p>If your code’s of the common translate-QCSchema-to-input, run,
translate-output-to-QCSchema variety, next work on the <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">execute</span></code>
function. This is fairly simple because it calls the powerful
qcengine.util.execute to handle scratch, timeout, file writing and
collection, etc. The harness function needs the names of input files
(hard-code a string for now), the execution command, and the names
of any scratch files to return for processing. Once ready, fill in
<code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">get_version</span></code> if not done above.</p></li>
</ol>
<ol class="arabic simple">
<li><p>Now fill in the short <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">compute</span></code> entirely and <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">build_input</span></code>
and <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">parse_output</span></code> skeletally. Set up a simple molecule-and-model
<code class="docutils literal notranslate"><span class="pre">AtomicInput</span></code> dictionary and run it with <code class="docutils literal notranslate"><span class="pre">qcng.compute(atomicinput,</span>
<span class="pre">&quot;yourcode&quot;)</span></code> to get something to iterate on.</p></li>
</ol>
<ol class="arabic simple">
<li><p>Fill in <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">build_input</span></code> to form your code’s usual input format
from the fields of <code class="docutils literal notranslate"><span class="pre">AtomicInput</span></code>.</p></li>
</ol>
<ol class="arabic simple">
<li><p>Fill in <code class="docutils literal notranslate"><span class="pre">def</span> <span class="pre">parse_output</span></code> to take results and put them
into <code class="docutils literal notranslate"><span class="pre">AtomicResult</span></code>. Most important is the <code class="docutils literal notranslate"><span class="pre">return_result</span></code>
field.  <code class="docutils literal notranslate"><span class="pre">AtomicResultProperties</span></code> can be populated when
convenient. <code class="docutils literal notranslate"><span class="pre">WavefunctionProperties</span></code> is great but save for a later
pass.</p></li>
</ol>
<ol class="arabic simple">
<li><p>At this point your harness can correctly run one or more QCSchema
inputs of your devising. Time to put it through paces. Register your
code in <code class="docutils literal notranslate"><span class="pre">_programs</span></code> in <code class="docutils literal notranslate"><span class="pre">testing.py</span></code>.  Most tests will then need a
<code class="docutils literal notranslate"><span class="pre">&#64;using(&quot;yourcode&quot;)</span></code> decorator so that they don’t run (and fail the
test suite) when your code isn’t available.</p></li>
</ol>
<ol class="arabic simple">
<li><p>Add basic tests to qcengine/tests/test_harness_canonical.py
* def test_compute_energy(program, model, keywords):
* def test_compute_gradient(program, model, keywords):
* def test_compute_energy_qcsk_basis(program, model, keywords):</p></li>
</ol>
<ol class="arabic simple">
<li><p>Add basic failure tests to qcengine/tests/test_harness_canonical.py
* def test_compute_bad_models(program, model):</p></li>
</ol>
<ol class="arabic simple">
<li><p>Add tests for the runtime config and to qcengine/programs/tests/test_canonical_config.py</p></li>
</ol>
<ol class="arabic simple">
<li><p>For QM codes, consider adding lines to the
qcengine/programs/tests/test_standard_suite.py to check energies,
gradients, and Hessians against other codes.</p></li>
</ol>
<ol class="arabic simple">
<li><p>For codes that can produce a Hartree–Fock, add lines to the
qcengine/program/tests/test_alignment.py to check molecular and
properties orientation handling.</p></li>
</ol>
<ol class="arabic simple">
<li><p>If your code is available as a visible binary (e.g., pip, conda,
docker download with no or trivial build), create a testing lane by
adding to <code class="docutils literal notranslate"><span class="pre">devtools/conda-envs/</span></code> and <code class="docutils literal notranslate"><span class="pre">.github/workflows/CI.yml</span></code>.
This will check your code for every PR. We’re looking into private
testing for codes that aren’t available.</p></li>
</ol>
<ol class="arabic simple">
<li><p>Throughout, talk with the maintainers with questions. Error handling,
especially, is intricate.</p></li>
</ol>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="changelog.html" class="btn btn-neutral float-left" title="Changelog" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2018-2023, The Molecular Sciences Software Institute.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>