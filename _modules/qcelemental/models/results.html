

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  

<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">



  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/small-apps.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/themefisher-font.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/style.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/graphviz.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/small-apps.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/themefisher-font.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/style.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" />
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-WJHQJQF');</script>
<!-- End Google Tag Manager -->
 

</head>

<body class="wy-body-for-nav">

  
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-WJHQJQF"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->


<div style="width: 100%" class="qca-header">
<nav class="navbar main-nav navbar-expand-lg p-0 qca-header">
  <div class="container nav-width">
    <div class="logo-width">
    <a class="navbar-brand" href="https://docs.qcarchive.molssi.org"><img src="https://docs.qcarchive.molssi.org/en/latest/_static/images/QCAInfrastructure.png" alt="logo" width=200px></a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav"
      aria-expanded="false" aria-label="Toggle navigation">
      <span class="tf-ion-android-menu"></span>
    </button>
    </div>
      <div class="collapse navbar-collapse" id=navbarNav>
         <ul class="navbar-nav ml-auto">
            <li class=nav-item>
                <a class=nav-link href=https://join.slack.com/t/qcarchive/shared_invite/enQtNDIzNTQ2OTExODk0LTE3MWI0YzBjNzVhNzczNDM0ZTA5MmQ1ODcxYTc0YTA1ZDQ2MTk1NDhlMjhjMmQ0YWYwOGMzYzJkZTM2NDlmOGM>
                Community Slack
                </a>
            </li>
            <li class=nav-item><a class=nav-link href=https://qcarchive.molssi.org></a></li>
            <li class="nav-item dropdown dropdown-slide">
               <a class=nav-link href=# data-toggle=dropdown>GitHub
               <span><i class=tf-ion-ios-arrow-down></i></span></a>
               <div class=dropdown-menu>
                  <a class=dropdown-item href=https://github.com/MolSSI/QCElemental>QCElemental</a>
                  <a class=dropdown-item href=https://github.com/MolSSI/QCEngine>QCEngine</a>
                  <a class=dropdown-item href=https://github.com/MolSSI/QCFractal>QCFractal</a>
                  <a class=dropdown-item href=https://github.com/MolSSI/QCFractal>QCPortal</a>
               </div>
            </li>
            <li class="nav-item dropdown dropdown-slide">
               <a class=nav-link href=# data-toggle=dropdown>Documentation
               <span><i class=tf-ion-ios-arrow-down></i></span></a>
               <div class=dropdown-menu>
                  <a class=dropdown-item href=https://docs.qcarchive.molssi.org/>Examples</a>
                  <a class=dropdown-item href=https://docs.qcarchive.molssi.org/projects/QCElemental/en/stable>QCElemental</a>
                  <a class=dropdown-item href=https://docs.qcarchive.molssi.org/projects/QCEngine/en/stable>QCEngine</a>
                  <a class=dropdown-item href=https://docs.qcarchive.molssi.org/projects/QCFractal/en/stable>QCFractal</a>
                  <a class=dropdown-item href=https://docs.qcarchive.molssi.org/projects/QCPortal/en/stable>QCPortal</a>
               </div>
            </li>
            <li class=nav-item><a class=nav-link href=https://qcarchive.molssi.org/><u>MolSSI Database</u></a></li>
         </ul>
      </div>
   </div>
   </div>
</nav>




  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home"> QCEngine
          

          
          </a>

          
            
            
              <div class="version">
                0+untagged.1.ge248d2f
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Install QCEngine</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">User Interface</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../single_compute.html">Single Compute</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../environment.html">Environment Detection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../cli.html">Command Line Interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Programs</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../program_overview.html">Program Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../programs_semiempirical.html">Semiempirical Quantum Mechanics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../programs_molecular_mechanics.html">Molecular Mechanics</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Developer Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../api.html">QCEngine API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../changelog.html">Changelog</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">QCEngine</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>qcelemental.models.results</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for qcelemental.models.results</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">functools</span> <span class="kn">import</span> <span class="n">partial</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">TYPE_CHECKING</span><span class="p">,</span> <span class="n">Any</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Set</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">Field</span><span class="p">,</span> <span class="n">constr</span><span class="p">,</span> <span class="n">validator</span>

<span class="kn">from</span> <span class="nn">..util</span> <span class="kn">import</span> <span class="n">provenance_stamp</span>
<span class="kn">from</span> <span class="nn">.basemodels</span> <span class="kn">import</span> <span class="n">ProtoModel</span><span class="p">,</span> <span class="n">qcschema_draft</span>
<span class="kn">from</span> <span class="nn">.basis</span> <span class="kn">import</span> <span class="n">BasisSet</span>
<span class="kn">from</span> <span class="nn">.common_models</span> <span class="kn">import</span> <span class="n">ComputeError</span><span class="p">,</span> <span class="n">DriverEnum</span><span class="p">,</span> <span class="n">Model</span><span class="p">,</span> <span class="n">Provenance</span><span class="p">,</span> <span class="n">qcschema_input_default</span><span class="p">,</span> <span class="n">qcschema_output_default</span>
<span class="kn">from</span> <span class="nn">.molecule</span> <span class="kn">import</span> <span class="n">Molecule</span>
<span class="kn">from</span> <span class="nn">.types</span> <span class="kn">import</span> <span class="n">Array</span>

<span class="k">if</span> <span class="n">TYPE_CHECKING</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">pydantic.typing</span> <span class="kn">import</span> <span class="n">ReprArgs</span>


<span class="k">class</span> <span class="nc">AtomicResultProperties</span><span class="p">(</span><span class="n">ProtoModel</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Named properties of quantum chemistry computations following the MolSSI QCSchema.</span>

<span class="sd">    All arrays are stored flat but must be reshapable into the dimensions in attribute ``shape``, with abbreviations as follows:</span>

<span class="sd">      * nao: number of atomic orbitals = calcinfo_nbasis</span>
<span class="sd">      * nmo: number of molecular orbitals</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Calcinfo</span>
    <span class="n">calcinfo_nbasis</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The number of basis functions for the computation.&quot;</span><span class="p">)</span>
    <span class="n">calcinfo_nmo</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The number of molecular orbitals for the computation.&quot;</span><span class="p">)</span>
    <span class="n">calcinfo_nalpha</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The number of alpha electrons in the computation.&quot;</span><span class="p">)</span>
    <span class="n">calcinfo_nbeta</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The number of beta electrons in the computation.&quot;</span><span class="p">)</span>
    <span class="n">calcinfo_natom</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The number of atoms in the computation.&quot;</span><span class="p">)</span>

    <span class="c1"># Canonical</span>
    <span class="n">nuclear_repulsion_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The nuclear repulsion energy.&quot;</span><span class="p">)</span>
    <span class="n">return_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The energy of the requested method, identical to ``return_result`` for ``driver=energy`` computations.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">return_gradient</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The gradient of the requested method, identical to ``return_result`` for ``driver=gradient`` computations.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h/a0&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">return_hessian</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The Hessian of the requested method, identical to ``return_result`` for ``driver=hessian`` computations.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h/a0^2&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># SCF Keywords</span>
    <span class="n">scf_one_electron_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The one-electron (core Hamiltonian) energy contribution to the total SCF energy.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">scf_two_electron_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The two-electron energy contribution to the total SCF energy.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">scf_vv10_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The VV10 functional energy contribution to the total SCF energy.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">scf_xc_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The functional (XC) energy contribution to the total SCF energy.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">scf_dispersion_correction_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The dispersion correction appended to an underlying functional when a DFT-D method is requested.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">scf_dipole_moment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The SCF X, Y, and Z dipole components&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;e a0&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">scf_quadrupole_moment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The quadrupole components (redundant; 6 unique).&quot;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;e a0^2&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">scf_total_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The total electronic energy of the SCF stage of the calculation.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">scf_total_gradient</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The total electronic gradient of the SCF stage of the calculation.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h/a0&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">scf_total_hessian</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The total electronic Hessian of the SCF stage of the calculation.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h/a0^2&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">scf_iterations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The number of SCF iterations taken before convergence.&quot;</span><span class="p">)</span>

    <span class="c1"># MP2 Keywords</span>
    <span class="n">mp2_same_spin_correlation_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The portion of MP2 doubles correlation energy from same-spin (i.e. triplet) correlations, without any user scaling.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">mp2_opposite_spin_correlation_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The portion of MP2 doubles correlation energy from opposite-spin (i.e. singlet) correlations, without any user scaling.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">mp2_singles_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The singles portion of the MP2 correlation energy. Zero except in ROHF.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">mp2_doubles_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The doubles portion of the MP2 correlation energy including same-spin and opposite-spin correlations.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">mp2_correlation_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The MP2 correlation energy.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">mp2_total_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The total MP2 energy (MP2 correlation energy + HF energy).&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">mp2_dipole_moment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The MP2 X, Y, and Z dipole components.&quot;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;e a0&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># CCSD Keywords</span>
    <span class="n">ccsd_same_spin_correlation_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The portion of CCSD doubles correlation energy from same-spin (i.e. triplet) correlations, without any user scaling.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsd_opposite_spin_correlation_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The portion of CCSD doubles correlation energy from opposite-spin (i.e. singlet) correlations, without any user scaling.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsd_singles_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The singles portion of the CCSD correlation energy. Zero except in ROHF.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsd_doubles_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The doubles portion of the CCSD correlation energy including same-spin and opposite-spin correlations.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsd_correlation_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The CCSD correlation energy.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsd_total_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The total CCSD energy (CCSD correlation energy + HF energy).&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsd_dipole_moment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The CCSD X, Y, and Z dipole components.&quot;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;e a0&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsd_iterations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The number of CCSD iterations taken before convergence.&quot;</span><span class="p">)</span>

    <span class="c1"># CCSD(T) keywords</span>
    <span class="n">ccsd_prt_pr_correlation_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The CCSD(T) correlation energy.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsd_prt_pr_total_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The total CCSD(T) energy (CCSD(T) correlation energy + HF energy).&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsd_prt_pr_dipole_moment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The CCSD(T) X, Y, and Z dipole components.&quot;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;e a0&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="c1"># CCSDT keywords</span>
    <span class="n">ccsdt_correlation_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The CCSDT correlation energy.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsdt_total_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The total CCSDT energy (CCSDT correlation energy + HF energy).&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsdt_dipole_moment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The CCSDT X, Y, and Z dipole components.&quot;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;e a0&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsdt_iterations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The number of CCSDT iterations taken before convergence.&quot;</span>
    <span class="p">)</span>

    <span class="c1"># CCSDTQ keywords</span>
    <span class="n">ccsdtq_correlation_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The CCSDTQ correlation energy.&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsdtq_total_energy</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The total CCSDTQ energy (CCSDTQ correlation energy + HF energy).&quot;</span><span class="p">,</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;E_h&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsdtq_dipole_moment</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The CCSDTQ X, Y, and Z dipole components.&quot;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
        <span class="n">units</span><span class="o">=</span><span class="s2">&quot;e a0&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">ccsdtq_iterations</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The number of CCSDTQ iterations taken before convergence.&quot;</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="n">ProtoModel</span><span class="o">.</span><span class="n">Config</span><span class="p">):</span>
        <span class="n">force_skip_defaults</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__repr_args__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ReprArgs&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[(</span><span class="n">k</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>

    <span class="nd">@validator</span><span class="p">(</span>
        <span class="s2">&quot;scf_dipole_moment&quot;</span><span class="p">,</span>
        <span class="s2">&quot;mp2_dipole_moment&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ccsd_dipole_moment&quot;</span><span class="p">,</span>
        <span class="s2">&quot;ccsd_prt_pr_dipole_moment&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scf_quadrupole_moment&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">_validate_poles</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_dipole_moment&quot;</span><span class="p">):</span>
            <span class="n">order</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_quadrupole_moment&quot;</span><span class="p">):</span>
            <span class="n">order</span> <span class="o">=</span> <span class="mi">2</span>

        <span class="n">shape</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">([</span><span class="mi">3</span><span class="p">]</span> <span class="o">*</span> <span class="n">order</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span>
        <span class="s2">&quot;return_gradient&quot;</span><span class="p">,</span>
        <span class="s2">&quot;return_hessian&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scf_total_gradient&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scf_total_hessian&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">_validate_derivs</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="n">field</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="n">nat</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;calcinfo_natom&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nat</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Please also set ``calcinfo_natom``!&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_gradient&quot;</span><span class="p">):</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">nat</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">field</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_hessian&quot;</span><span class="p">):</span>
            <span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">nat</span><span class="p">,</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">nat</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">shape</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Derivative must be castable to shape </span><span class="si">{</span><span class="n">shape</span><span class="si">}</span><span class="s2">!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="k">def</span> <span class="nf">dict</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># pure-json dict repr for QCFractal compliance, see https://github.com/MolSSI/QCFractal/issues/579</span>
        <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;encoding&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;json&quot;</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">dict</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">WavefunctionProperties</span><span class="p">(</span><span class="n">ProtoModel</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Wavefunction properties resulting from a computation. Matrix quantities are stored in column-major order. Presence and contents configurable by protocol.&quot;&quot;&quot;</span>

    <span class="c1"># Class properties</span>
    <span class="n">_return_results_names</span><span class="p">:</span> <span class="n">Set</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;orbitals_a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;orbitals_b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;density_a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;density_b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fock_a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fock_b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;eigenvalues_a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;eigenvalues_b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;occupations_a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;occupations_b&quot;</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="c1"># The full basis set description of the quantities</span>
    <span class="n">basis</span><span class="p">:</span> <span class="n">BasisSet</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">BasisSet</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">))</span>
    <span class="n">restricted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span>
            <span class="s2">&quot;If the computation was restricted or not (alpha == beta). If True, all beta quantities are skipped.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>

    <span class="c1"># Core Hamiltonian</span>
    <span class="n">h_core_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Alpha-spin core (one-electron) Hamiltonian in the AO basis.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nao&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">h_core_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Beta-spin core (one-electron) Hamiltonian in the AO basis.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nao&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">h_effective_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Alpha-spin effective core (one-electron) Hamiltonian in the AO basis.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nao&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">h_effective_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Beta-spin effective core (one-electron) Hamiltonian in the AO basis&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nao&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># SCF Results</span>
    <span class="n">scf_orbitals_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SCF alpha-spin orbitals in the AO basis.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nmo&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">scf_orbitals_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SCF beta-spin orbitals in the AO basis.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nmo&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">scf_density_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SCF alpha-spin density matrix in the AO basis.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nao&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">scf_density_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SCF beta-spin density matrix in the AO basis.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nao&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">scf_fock_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SCF alpha-spin Fock matrix in the AO basis.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nao&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">scf_fock_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SCF beta-spin Fock matrix in the AO basis.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nao&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">scf_eigenvalues_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SCF alpha-spin orbital eigenvalues.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nmo&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">scf_eigenvalues_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SCF beta-spin orbital eigenvalues.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nmo&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">scf_occupations_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SCF alpha-spin orbital occupations.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nmo&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">scf_occupations_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SCF beta-spin orbital occupations.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nmo&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># BELOW from qcsk</span>
    <span class="n">scf_coulomb_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SCF alpha-spin Coulomb matrix in the AO basis.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nao&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">scf_coulomb_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SCF beta-spin Coulomb matrix in the AO basis.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nao&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">scf_exchange_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SCF alpha-spin exchange matrix in the AO basis.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nao&quot;</span><span class="p">]</span>
    <span class="p">)</span>
    <span class="n">scf_exchange_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;SCF beta-spin exchange matrix in the AO basis.&quot;</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nao&quot;</span><span class="p">]</span>
    <span class="p">)</span>

    <span class="c1"># Localized-orbital SCF wavefunction quantities</span>
    <span class="n">localized_orbitals_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Localized alpha-spin orbitals in the AO basis. All nmo orbitals are included, even if only a subset were localized.&quot;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nmo&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">localized_orbitals_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Localized beta-spin orbitals in the AO basis. All nmo orbitals are included, even if only a subset were localized.&quot;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nao&quot;</span><span class="p">,</span> <span class="s2">&quot;nmo&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">localized_fock_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Alpha-spin Fock matrix in the localized molecular orbital basis. All nmo orbitals are included, even if only a subset were localized.&quot;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nmo&quot;</span><span class="p">,</span> <span class="s2">&quot;nmo&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">localized_fock_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Beta-spin Fock matrix in the localized molecular orbital basis. All nmo orbitals are included, even if only a subset were localized.&quot;</span><span class="p">,</span>
        <span class="n">shape</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;nmo&quot;</span><span class="p">,</span> <span class="s2">&quot;nmo&quot;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="c1"># ABOVE from qcsk</span>

    <span class="c1"># Return results, must be defined last</span>
    <span class="n">orbitals_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Index to the alpha-spin orbitals of the primary return.&quot;</span><span class="p">)</span>
    <span class="n">orbitals_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Index to the beta-spin orbitals of the primary return.&quot;</span><span class="p">)</span>
    <span class="n">density_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Index to the alpha-spin density of the primary return.&quot;</span><span class="p">)</span>
    <span class="n">density_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Index to the beta-spin density of the primary return.&quot;</span><span class="p">)</span>
    <span class="n">fock_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Index to the alpha-spin Fock matrix of the primary return.&quot;</span><span class="p">)</span>
    <span class="n">fock_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Index to the beta-spin Fock matrix of the primary return.&quot;</span><span class="p">)</span>
    <span class="n">eigenvalues_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Index to the alpha-spin orbital eigenvalues of the primary return.&quot;</span>
    <span class="p">)</span>
    <span class="n">eigenvalues_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Index to the beta-spin orbital eigenvalues of the primary return.&quot;</span>
    <span class="p">)</span>
    <span class="n">occupations_a</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Index to the alpha-spin orbital occupations of the primary return.&quot;</span>
    <span class="p">)</span>
    <span class="n">occupations_b</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Index to the beta-spin orbital occupations of the primary return.&quot;</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="n">ProtoModel</span><span class="o">.</span><span class="n">Config</span><span class="p">):</span>
        <span class="n">force_skip_defaults</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;scf_eigenvalues_a&quot;</span><span class="p">,</span> <span class="s2">&quot;scf_eigenvalues_b&quot;</span><span class="p">,</span> <span class="s2">&quot;scf_occupations_a&quot;</span><span class="p">,</span> <span class="s2">&quot;scf_occupations_b&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_assert1d</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Vector must be castable to shape (-1, )!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;scf_orbitals_a&quot;</span><span class="p">,</span> <span class="s2">&quot;scf_orbitals_b&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_assert2d_nao_x</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">bas</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;basis&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Do not raise multiple errors</span>
        <span class="k">if</span> <span class="n">bas</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">bas</span><span class="o">.</span><span class="n">nbf</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Matrix must be castable to shape (nbf, -1)!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span>
        <span class="s2">&quot;h_core_a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;h_core_b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;h_effective_a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;h_effective_b&quot;</span><span class="p">,</span>
        <span class="c1"># SCF</span>
        <span class="s2">&quot;scf_density_a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scf_density_b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scf_fock_a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;scf_fock_b&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">_assert2d</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="n">bas</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;basis&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="c1"># Do not raise multiple errors</span>
        <span class="k">if</span> <span class="n">bas</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">v</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">bas</span><span class="o">.</span><span class="n">nbf</span><span class="p">,</span> <span class="n">bas</span><span class="o">.</span><span class="n">nbf</span><span class="p">)</span>
        <span class="k">except</span> <span class="p">(</span><span class="ne">ValueError</span><span class="p">,</span> <span class="ne">AttributeError</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Matrix must be castable to shape (nbf, nbf)!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span>
        <span class="s2">&quot;orbitals_a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;orbitals_b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;density_a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;density_b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fock_a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fock_b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;eigenvalues_a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;eigenvalues_b&quot;</span><span class="p">,</span>
        <span class="s2">&quot;occupations_a&quot;</span><span class="p">,</span>
        <span class="s2">&quot;occupations_b&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">def</span> <span class="nf">_assert_exists</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>

        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Return quantity </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2"> does not exist in the values.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">v</span>


<span class="k">class</span> <span class="nc">WavefunctionProtocolEnum</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">Enum</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Wavefunction to keep from a computation.&quot;&quot;&quot;</span>

    <span class="nb">all</span> <span class="o">=</span> <span class="s2">&quot;all&quot;</span>
    <span class="n">orbitals_and_eigenvalues</span> <span class="o">=</span> <span class="s2">&quot;orbitals_and_eigenvalues&quot;</span>
    <span class="n">return_results</span> <span class="o">=</span> <span class="s2">&quot;return_results&quot;</span>
    <span class="n">none</span> <span class="o">=</span> <span class="s2">&quot;none&quot;</span>


<span class="k">class</span> <span class="nc">ErrorCorrectionProtocol</span><span class="p">(</span><span class="n">ProtoModel</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Configuration for how QCEngine handles error correction</span>

<span class="sd">    WARNING: These protocols are currently experimental and only supported by NWChem tasks</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">default_policy</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Whether to allow error corrections to be used &quot;</span> <span class="s2">&quot;if not directly specified in `policies`&quot;</span>
    <span class="p">)</span>
    <span class="c1"># TODO (wardlt): Consider support for common policies (e.g., &#39;only increase iterations&#39;) as strings (see #182)</span>
    <span class="n">policies</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">bool</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Settings that define whether specific error corrections are allowed. &quot;</span>
        <span class="s2">&quot;Keys are the name of a known error and values are whether it is allowed to be used.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">def</span> <span class="nf">allows</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">policy</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">policies</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_policy</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">policies</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">policy</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_policy</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">AtomicResultProtocols</span><span class="p">(</span><span class="n">ProtoModel</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Protocols regarding the manipulation of computational result data.&quot;&quot;&quot;</span>

    <span class="n">wavefunction</span><span class="p">:</span> <span class="n">WavefunctionProtocolEnum</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">WavefunctionProtocolEnum</span><span class="o">.</span><span class="n">none</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">WavefunctionProtocolEnum</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">)</span>
    <span class="p">)</span>
    <span class="n">stdout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Primary output file to keep from the computation&quot;</span><span class="p">)</span>
    <span class="n">error_correction</span><span class="p">:</span> <span class="n">ErrorCorrectionProtocol</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">ErrorCorrectionProtocol</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Policies for error correction&quot;</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">:</span>
        <span class="n">force_skip_defaults</span> <span class="o">=</span> <span class="kc">True</span>


<span class="c1">### Primary models</span>


<div class="viewcode-block" id="AtomicInput"><a class="viewcode-back" href="../../../single_compute.html#qcelemental.models.AtomicInput">[docs]</a><span class="k">class</span> <span class="nc">AtomicInput</span><span class="p">(</span><span class="n">ProtoModel</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;The MolSSI Quantum Chemistry Schema&quot;&quot;&quot;</span>

    <span class="nb">id</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The optional ID for the computation.&quot;</span><span class="p">)</span>
    <span class="n">schema_name</span><span class="p">:</span> <span class="n">constr</span><span class="p">(</span><span class="n">strip_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="s2">&quot;^(qc_?schema_input)$&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
        <span class="n">qcschema_input_default</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The QCSchema specification this model conforms to. Explicitly fixed as </span><span class="si">{</span><span class="n">qcschema_input_default</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">schema_version</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The version number of ``schema_name`` to which this model conforms.&quot;</span><span class="p">)</span>

    <span class="n">molecule</span><span class="p">:</span> <span class="n">Molecule</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The molecule to use in the computation.&quot;</span><span class="p">)</span>
    <span class="n">driver</span><span class="p">:</span> <span class="n">DriverEnum</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">DriverEnum</span><span class="o">.</span><span class="vm">__doc__</span><span class="p">))</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">Model</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Model</span><span class="o">.</span><span class="n">__base_doc__</span><span class="p">))</span>
    <span class="n">keywords</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">({},</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The program-specific keywords to be used.&quot;</span><span class="p">)</span>
    <span class="n">protocols</span><span class="p">:</span> <span class="n">AtomicResultProtocols</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">AtomicResultProtocols</span><span class="p">(),</span> <span class="n">description</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">AtomicResultProtocols</span><span class="o">.</span><span class="n">__base_doc__</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="n">extras</span><span class="p">:</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="p">{},</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;Additional information to bundle with the computation. Use for schema development and scratch space.&quot;</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">provenance</span><span class="p">:</span> <span class="n">Provenance</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="n">default_factory</span><span class="o">=</span><span class="n">partial</span><span class="p">(</span><span class="n">provenance_stamp</span><span class="p">,</span> <span class="vm">__name__</span><span class="p">),</span> <span class="n">description</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Provenance</span><span class="o">.</span><span class="n">__base_doc__</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">class</span> <span class="nc">Config</span><span class="p">(</span><span class="n">ProtoModel</span><span class="o">.</span><span class="n">Config</span><span class="p">):</span>
        <span class="k">def</span> <span class="nf">schema_extra</span><span class="p">(</span><span class="n">schema</span><span class="p">,</span> <span class="n">model</span><span class="p">):</span>
            <span class="n">schema</span><span class="p">[</span><span class="s2">&quot;$schema&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">qcschema_draft</span>

    <span class="k">def</span> <span class="nf">__repr_args__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;ReprArgs&quot;</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;driver&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">driver</span><span class="o">.</span><span class="n">value</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;model&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">dict</span><span class="p">()),</span>
            <span class="p">(</span><span class="s2">&quot;molecule_hash&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">molecule</span><span class="o">.</span><span class="n">get_hash</span><span class="p">()[:</span><span class="mi">7</span><span class="p">]),</span>
        <span class="p">]</span></div>


<div class="viewcode-block" id="AtomicResult"><a class="viewcode-back" href="../../../single_compute.html#qcelemental.models.AtomicResult">[docs]</a><span class="k">class</span> <span class="nc">AtomicResult</span><span class="p">(</span><span class="n">AtomicInput</span><span class="p">):</span>
    <span class="sa">r</span><span class="sd">&quot;&quot;&quot;Results from a CMS program execution.&quot;&quot;&quot;</span>

    <span class="n">schema_name</span><span class="p">:</span> <span class="n">constr</span><span class="p">(</span><span class="n">strip_whitespace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">regex</span><span class="o">=</span><span class="s2">&quot;^(qc_?schema_output)$&quot;</span><span class="p">)</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>  <span class="c1"># type: ignore</span>
        <span class="n">qcschema_output_default</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;The QCSchema specification this model conforms to. Explicitly fixed as </span><span class="si">{</span><span class="n">qcschema_output_default</span><span class="si">}</span><span class="s2">.&quot;</span>
        <span class="p">),</span>
    <span class="p">)</span>
    <span class="n">properties</span><span class="p">:</span> <span class="n">AtomicResultProperties</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">AtomicResultProperties</span><span class="o">.</span><span class="n">__base_doc__</span><span class="p">))</span>
    <span class="n">wavefunction</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">WavefunctionProperties</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">WavefunctionProperties</span><span class="o">.</span><span class="n">__base_doc__</span><span class="p">))</span>

    <span class="n">return_result</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">Array</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Any</span><span class="p">]]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="o">...</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The primary return specified by the ``driver`` field. Scalar if energy; array if gradient or hessian; dictionary with property keys if properties.&quot;</span><span class="p">,</span>
    <span class="p">)</span>  <span class="c1"># type: ignore</span>

    <span class="n">stdout</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span>
        <span class="kc">None</span><span class="p">,</span>
        <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The primary logging output of the program, whether natively standard output or a file. Presence vs. absence (or null-ness?) configurable by protocol.&quot;</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">stderr</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The standard error of the program execution.&quot;</span><span class="p">)</span>

    <span class="n">success</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="s2">&quot;The success of program execution. If False, other fields may be blank.&quot;</span><span class="p">)</span>
    <span class="n">error</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ComputeError</span><span class="p">]</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">ComputeError</span><span class="o">.</span><span class="n">__base_doc__</span><span class="p">))</span>
    <span class="n">provenance</span><span class="p">:</span> <span class="n">Provenance</span> <span class="o">=</span> <span class="n">Field</span><span class="p">(</span><span class="o">...</span><span class="p">,</span> <span class="n">description</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">Provenance</span><span class="o">.</span><span class="n">__base_doc__</span><span class="p">))</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;schema_name&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_input_to_output</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">):</span>
        <span class="sa">r</span><span class="sd">&quot;&quot;&quot;If qcschema_input is passed in, cast it to output, otherwise no&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">v</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="n">qcschema_input_default</span><span class="p">,</span> <span class="n">qcschema_output_default</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">qcschema_output_default</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s2">&quot;Only </span><span class="si">{0}</span><span class="s2"> or </span><span class="si">{1}</span><span class="s2"> is allowed for schema_name, &quot;</span>
            <span class="s2">&quot;which will be converted to </span><span class="si">{0}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">qcschema_output_default</span><span class="p">,</span> <span class="n">qcschema_input_default</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;return_result&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_validate_return_result</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;driver&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;gradient&quot;</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">)</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;driver&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;hessian&quot;</span><span class="p">:</span>
            <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
            <span class="n">nsq</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">size</span> <span class="o">**</span> <span class="mf">0.5</span><span class="p">)</span>
            <span class="n">v</span><span class="o">.</span><span class="n">shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">nsq</span><span class="p">,</span> <span class="n">nsq</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">v</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;wavefunction&quot;</span><span class="p">,</span> <span class="n">pre</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_wavefunction_protocol</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>

        <span class="c1"># We are pre, gotta do extra checks</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="n">wfn</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">WavefunctionProperties</span><span class="p">):</span>
            <span class="n">wfn</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">dict</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;wavefunction must be None, a dict, or a WavefunctionProperties object.&quot;</span><span class="p">)</span>

        <span class="c1"># Do not propagate validation errors</span>
        <span class="k">if</span> <span class="s2">&quot;protocols&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Protocols was not properly formed.&quot;</span><span class="p">)</span>

        <span class="c1"># Handle restricted</span>
        <span class="n">restricted</span> <span class="o">=</span> <span class="n">wfn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;restricted&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">restricted</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`restricted` is required.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">restricted</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">wfn</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
                <span class="k">if</span> <span class="n">k</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;_b&quot;</span><span class="p">):</span>
                    <span class="n">wfn</span><span class="o">.</span><span class="n">pop</span><span class="p">(</span><span class="n">k</span><span class="p">)</span>

        <span class="c1"># Handle protocols</span>
        <span class="n">wfnp</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;protocols&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">wavefunction</span>
        <span class="n">return_keep</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">if</span> <span class="n">wfnp</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">wfnp</span> <span class="o">==</span> <span class="s2">&quot;none&quot;</span><span class="p">:</span>
            <span class="n">wfn</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">elif</span> <span class="n">wfnp</span> <span class="o">==</span> <span class="s2">&quot;return_results&quot;</span><span class="p">:</span>
            <span class="n">return_keep</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s2">&quot;orbitals_a&quot;</span><span class="p">,</span>
                <span class="s2">&quot;orbitals_b&quot;</span><span class="p">,</span>
                <span class="s2">&quot;density_a&quot;</span><span class="p">,</span>
                <span class="s2">&quot;density_b&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fock_a&quot;</span><span class="p">,</span>
                <span class="s2">&quot;fock_b&quot;</span><span class="p">,</span>
                <span class="s2">&quot;eigenvalues_a&quot;</span><span class="p">,</span>
                <span class="s2">&quot;eigenvalues_b&quot;</span><span class="p">,</span>
                <span class="s2">&quot;occupations_a&quot;</span><span class="p">,</span>
                <span class="s2">&quot;occupations_b&quot;</span><span class="p">,</span>
            <span class="p">]</span>
        <span class="k">elif</span> <span class="n">wfnp</span> <span class="o">==</span> <span class="s2">&quot;orbitals_and_eigenvalues&quot;</span><span class="p">:</span>
            <span class="n">return_keep</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;orbitals_a&quot;</span><span class="p">,</span> <span class="s2">&quot;orbitals_b&quot;</span><span class="p">,</span> <span class="s2">&quot;eigenvalues_a&quot;</span><span class="p">,</span> <span class="s2">&quot;eigenvalues_b&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Protocol `wavefunction:</span><span class="si">{</span><span class="n">wfnp</span><span class="si">}</span><span class="s2">` is not understood.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">return_keep</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ret_wfn</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;restricted&quot;</span><span class="p">:</span> <span class="n">restricted</span><span class="p">}</span>
            <span class="k">if</span> <span class="s2">&quot;basis&quot;</span> <span class="ow">in</span> <span class="n">wfn</span><span class="p">:</span>
                <span class="n">ret_wfn</span><span class="p">[</span><span class="s2">&quot;basis&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">wfn</span><span class="p">[</span><span class="s2">&quot;basis&quot;</span><span class="p">]</span>

            <span class="k">for</span> <span class="n">rk</span> <span class="ow">in</span> <span class="n">return_keep</span><span class="p">:</span>
                <span class="n">key</span> <span class="o">=</span> <span class="n">wfn</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">rk</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">key</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="n">ret_wfn</span><span class="p">[</span><span class="n">rk</span><span class="p">]</span> <span class="o">=</span> <span class="n">key</span>
                <span class="n">ret_wfn</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">wfn</span><span class="p">[</span><span class="n">key</span><span class="p">]</span>

            <span class="k">return</span> <span class="n">ret_wfn</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">wfn</span>

    <span class="nd">@validator</span><span class="p">(</span><span class="s2">&quot;stdout&quot;</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">_stdout_protocol</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">values</span><span class="p">):</span>

        <span class="c1"># Do not propagate validation errors</span>
        <span class="k">if</span> <span class="s2">&quot;protocols&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">values</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Protocols was not properly formed.&quot;</span><span class="p">)</span>

        <span class="n">outp</span> <span class="o">=</span> <span class="n">values</span><span class="p">[</span><span class="s2">&quot;protocols&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">stdout</span>
        <span class="k">if</span> <span class="n">outp</span> <span class="ow">is</span> <span class="kc">True</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">value</span>
        <span class="k">elif</span> <span class="n">outp</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Protocol `stdout:</span><span class="si">{</span><span class="n">outp</span><span class="si">}</span><span class="s2">` is not understood&quot;</span><span class="p">)</span></div>


<span class="k">class</span> <span class="nc">ResultProperties</span><span class="p">(</span><span class="n">AtomicResultProperties</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>

        <span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;ResultProperties has been renamed to AtomicResultProperties and will be removed in v0.13.0&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ResultProtocols</span><span class="p">(</span><span class="n">AtomicResultProtocols</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>

        <span class="n">warn</span><span class="p">(</span>
            <span class="s2">&quot;ResultProtocols has been renamed to AtomicResultProtocols and will be removed in v0.13.0&quot;</span><span class="p">,</span>
            <span class="ne">DeprecationWarning</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">ResultInput</span><span class="p">(</span><span class="n">AtomicInput</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>

        <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;ResultInput has been renamed to AtomicInput and will be removed in v0.13.0&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">Result</span><span class="p">(</span><span class="n">AtomicResult</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">warnings</span> <span class="kn">import</span> <span class="n">warn</span>

        <span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Result has been renamed to AtomicResult and will be removed in v0.13.0&quot;</span><span class="p">,</span> <span class="ne">DeprecationWarning</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2018-2021, The Molecular Sciences Software Institute.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>